{"ast":null,"code":"class handwriting {\n  constructor(obj) {\n    this.Canvas = function (cvs, lineWidth, lineColor) {\n      this.canvas = cvs;\n      this.cxt = cvs.getContext(\"2d\");\n      this.cxt.lineCap = \"round\";\n      this.cxt.lineJoin = \"round\";\n      this.lineWidth = lineWidth || 3;\n      this.lineColor = lineColor || \"#000\";\n      this.width = cvs.width;\n      this.height = cvs.height;\n      this.drawing = false;\n      this.handwritingX = [];\n      this.handwritingY = [];\n      this.trace = [];\n      this.options = {};\n      this.step = [];\n      this.redo_step = [];\n      this.redo_trace = [];\n      this.allowUndo = false;\n      this.allowRedo = false;\n      cvs.addEventListener(\"mousedown\", this.mouseDown.bind(this));\n      cvs.addEventListener(\"mousemove\", this.mouseMove.bind(this));\n      cvs.addEventListener(\"mouseup\", this.mouseUp.bind(this));\n      cvs.addEventListener(\"touchstart\", this.touchStart.bind(this));\n      cvs.addEventListener(\"touchmove\", this.touchMove.bind(this));\n      cvs.addEventListener(\"touchend\", this.touchEnd.bind(this));\n      this.callback = undefined;\n    };\n\n    this.loadFromUrl = function (url, cvs) {\n      var imageObj = new Image();\n\n      imageObj.onload = function () {\n        cvs.cxt.clearRect(0, 0, this.width, this.height);\n        cvs.cxt.drawImage(imageObj, 0, 0);\n      };\n\n      imageObj.src = url;\n    };\n\n    this.set_Undo_Redo = function (undo, redo) {\n      this.allowUndo = undo;\n      this.allowRedo = undo ? redo : false;\n\n      if (!this.allowUndo) {\n        this.step = [];\n        this.redo_step = [];\n        this.redo_trace = [];\n      }\n    };\n\n    this.setLineWidth = function (lineWidth) {\n      this.lineWidth = lineWidth;\n    };\n\n    this.setLineColor = function (lineColor) {\n      this.lineColor = lineColor;\n    };\n\n    this.setCallBack = function (callback) {\n      this.callback = callback;\n    };\n\n    this.setOptions = function (options) {\n      this.options = options;\n    };\n\n    this.mouseDown = function (e) {\n      // new stroke\n      this.cxt.lineWidth = this.lineWidth;\n      this.cxt.strokeStyle = this.lineColor;\n      this.handwritingX = [];\n      this.handwritingY = [];\n      this.drawing = true;\n      this.cxt.beginPath();\n      var rect = this.canvas.getBoundingClientRect();\n      var x = e.clientX - rect.left;\n      var y = e.clientY - rect.top;\n      this.cxt.moveTo(x, y);\n      this.handwritingX.push(x);\n      this.handwritingY.push(y);\n    };\n\n    this.mouseMove = function (e) {\n      if (this.drawing) {\n        var rect = this.canvas.getBoundingClientRect();\n        var x = e.clientX - rect.left;\n        var y = e.clientY - rect.top;\n        this.cxt.lineTo(x, y);\n        this.cxt.stroke();\n        this.handwritingX.push(x);\n        this.handwritingY.push(y);\n      }\n    };\n\n    this.mouseUp = function () {\n      var w = [];\n      w.push(this.handwritingX);\n      w.push(this.handwritingY);\n      w.push([]);\n      this.trace.push(w);\n      this.drawing = false;\n      if (this.allowUndo) this.step.push(this.canvas.toDataURL());\n    };\n\n    this.touchStart = function (e) {\n      e.preventDefault();\n      this.cxt.lineWidth = this.lineWidth;\n      this.cxt.strokeStyle = this.lineColor;\n      this.handwritingX = [];\n      this.handwritingY = [];\n      var de = document.documentElement;\n      var box = this.canvas.getBoundingClientRect();\n      var top = box.top + window.pageYOffset - de.clientTop;\n      var left = box.left + window.pageXOffset - de.clientLeft;\n      var touch = e.changedTouches[0];\n      var touchX = touch.pageX - left;\n      var touchY = touch.pageY - top;\n      this.handwritingX.push(touchX);\n      this.handwritingY.push(touchY);\n      this.cxt.beginPath();\n      this.cxt.moveTo(touchX, touchY);\n    };\n\n    this.touchMove = function (e) {\n      e.preventDefault();\n      var touch = e.targetTouches[0];\n      var de = document.documentElement;\n      var box = this.canvas.getBoundingClientRect();\n      var top = box.top + window.pageYOffset - de.clientTop;\n      var left = box.left + window.pageXOffset - de.clientLeft;\n      var x = touch.pageX - left;\n      var y = touch.pageY - top;\n      this.handwritingX.push(x);\n      this.handwritingY.push(y);\n      this.cxt.lineTo(x, y);\n      this.cxt.stroke();\n    };\n\n    this.touchEnd = function (e) {\n      var w = [];\n      w.push(this.handwritingX);\n      w.push(this.handwritingY);\n      w.push([]);\n      this.trace.push(w);\n      if (this.allowUndo) this.step.push(this.canvas.toDataURL());\n    };\n\n    this.undo = function () {\n      if (!this.allowUndo || this.step.length <= 0) return;else if (this.step.length === 1) {\n        if (this.allowRedo) {\n          this.redo_step.push(this.step.pop());\n          this.redo_trace.push(this.trace.pop());\n          this.cxt.clearRect(0, 0, this.width, this.height);\n        }\n      } else {\n        if (this.allowRedo) {\n          this.redo_step.push(this.step.pop());\n          this.redo_trace.push(this.trace.pop());\n        } else {\n          this.step.pop();\n          this.trace.pop();\n        }\n\n        this.loadFromUrl(this.step.slice(-1)[0], this);\n      }\n    };\n\n    this.redo = function () {\n      if (!this.allowRedo || this.redo_step.length <= 0) return;\n      this.step.push(this.redo_step.pop());\n      this.trace.push(this.redo_trace.pop());\n      this.loadFromUrl(this.step.slice(-1)[0], this);\n    };\n\n    this.erase = function () {\n      this.cxt.clearRect(0, 0, this.width, this.height);\n      this.step = [];\n      this.redo_step = [];\n      this.redo_trace = [];\n      this.trace = [];\n    };\n\n    this.recognize = function (trace, options, callback) {\n      // if (handwriting.Canvas && this instanceof handwriting.Canvas) {\n      //   trace = this.trace;\n      //   options = this.options;\n      //   callback = this.callback;\n      // } else if (!options) options = {};\n      trace = this.trace;\n      options = this.options;\n      callback = this.callback;\n      var data = JSON.stringify({\n        options: \"enable_pre_space\",\n        requests: [{\n          writing_guide: {\n            writing_area_width: options.width || this.width || undefined,\n            writing_area_height: options.height || this.width || undefined\n          },\n          ink: trace,\n          language: options.language || \"en\"\n        }]\n      });\n      var xhr = new XMLHttpRequest();\n      xhr.addEventListener(\"readystatechange\", function () {\n        if (this.readyState === 4) {\n          switch (this.status) {\n            case 200:\n              var response = JSON.parse(this.responseText);\n              var results;\n              if (response.length === 1) callback(undefined, new Error(response[0]));else results = response[1][0][1];\n\n              if (!!options.numOfWords) {\n                results = results.filter(function (result) {\n                  return result.length === options.numOfWords;\n                });\n              }\n\n              if (!!options.numOfReturn) {\n                results = results.slice(0, options.numOfReturn);\n              }\n\n              callback(results, undefined);\n              break;\n\n            case 403:\n              callback(undefined, new Error(\"access denied\"));\n              break;\n\n            case 503:\n              callback(undefined, new Error(\"can't connect to recognition server\"));\n              break;\n\n            default:\n              callback(undefined, new Error(\"Unexpected result code\"));\n          }\n        }\n      }); // xhr.open(\n      //   \"POST\",\n      //   \"https://www.google.com.tw/inputtools/request?ime=handwriting&app=mobilesearch&cs=1&oe=UTF-8\"\n      // );\n\n      xhr.open(\"POST\", \"https://www.google.com.au/inputtools/request?ime=handwriting&app=mobilesearch&cs=1&oe=UTF-8\");\n      xhr.setRequestHeader(\"content-type\", \"application/json\");\n      xhr.send(data);\n    };\n\n    if (obj instanceof handwriting) return obj;\n    if (!(this instanceof handwriting)) return new handwriting(obj);\n    this._wrapped = obj;\n  }\n\n}\n\nexport default handwriting;","map":{"version":3,"sources":["/Users/charland/Documents/GitHub/twilio-gumball-ws-host/src/HandwritingCanvas.js"],"names":["handwriting","constructor","obj","Canvas","cvs","lineWidth","lineColor","canvas","cxt","getContext","lineCap","lineJoin","width","height","drawing","handwritingX","handwritingY","trace","options","step","redo_step","redo_trace","allowUndo","allowRedo","addEventListener","mouseDown","bind","mouseMove","mouseUp","touchStart","touchMove","touchEnd","callback","undefined","loadFromUrl","url","imageObj","Image","onload","clearRect","drawImage","src","set_Undo_Redo","undo","redo","setLineWidth","setLineColor","setCallBack","setOptions","e","strokeStyle","beginPath","rect","getBoundingClientRect","x","clientX","left","y","clientY","top","moveTo","push","lineTo","stroke","w","toDataURL","preventDefault","de","document","documentElement","box","window","pageYOffset","clientTop","pageXOffset","clientLeft","touch","changedTouches","touchX","pageX","touchY","pageY","targetTouches","length","pop","slice","erase","recognize","data","JSON","stringify","requests","writing_guide","writing_area_width","writing_area_height","ink","language","xhr","XMLHttpRequest","readyState","status","response","parse","responseText","results","Error","numOfWords","filter","result","numOfReturn","open","setRequestHeader","send","_wrapped"],"mappings":"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","sourcesContent":["class handwriting {\n  constructor(obj) {\n    if (obj instanceof handwriting) return obj;\n    if (!(this instanceof handwriting)) return new handwriting(obj);\n    this._wrapped = obj;\n  }\n\n  Canvas = function (cvs, lineWidth, lineColor) {\n    this.canvas = cvs;\n    this.cxt = cvs.getContext(\"2d\");\n    this.cxt.lineCap = \"round\";\n    this.cxt.lineJoin = \"round\";\n    this.lineWidth = lineWidth || 3;\n    this.lineColor = lineColor || \"#000\";\n    this.width = cvs.width;\n    this.height = cvs.height;\n    this.drawing = false;\n    this.handwritingX = [];\n    this.handwritingY = [];\n    this.trace = [];\n    this.options = {};\n    this.step = [];\n    this.redo_step = [];\n    this.redo_trace = [];\n    this.allowUndo = false;\n    this.allowRedo = false;\n    cvs.addEventListener(\"mousedown\", this.mouseDown.bind(this));\n    cvs.addEventListener(\"mousemove\", this.mouseMove.bind(this));\n    cvs.addEventListener(\"mouseup\", this.mouseUp.bind(this));\n    cvs.addEventListener(\"touchstart\", this.touchStart.bind(this));\n    cvs.addEventListener(\"touchmove\", this.touchMove.bind(this));\n    cvs.addEventListener(\"touchend\", this.touchEnd.bind(this));\n    this.callback = undefined;\n  };\n\n  loadFromUrl = function (url, cvs) {\n    var imageObj = new Image();\n    imageObj.onload = function () {\n      cvs.cxt.clearRect(0, 0, this.width, this.height);\n      cvs.cxt.drawImage(imageObj, 0, 0);\n    };\n    imageObj.src = url;\n  };\n\n  /**\n   * [toggle_Undo_Redo description]\n   * @return {[type]} [description]\n   */\n  set_Undo_Redo = function (undo, redo) {\n    this.allowUndo = undo;\n    this.allowRedo = undo ? redo : false;\n    if (!this.allowUndo) {\n      this.step = [];\n      this.redo_step = [];\n      this.redo_trace = [];\n    }\n  };\n\n  setLineWidth = function (lineWidth) {\n    this.lineWidth = lineWidth;\n  };\n\n  setLineColor = function (lineColor) {\n    this.lineColor = lineColor;\n  };\n\n  setCallBack = function (callback) {\n    this.callback = callback;\n  };\n\n  setOptions = function (options) {\n    this.options = options;\n  };\n\n  mouseDown = function (e) {\n    // new stroke\n    this.cxt.lineWidth = this.lineWidth;\n    this.cxt.strokeStyle = this.lineColor;\n    this.handwritingX = [];\n    this.handwritingY = [];\n    this.drawing = true;\n    this.cxt.beginPath();\n    var rect = this.canvas.getBoundingClientRect();\n    var x = e.clientX - rect.left;\n    var y = e.clientY - rect.top;\n    this.cxt.moveTo(x, y);\n    this.handwritingX.push(x);\n    this.handwritingY.push(y);\n  };\n\n  mouseMove = function (e) {\n    if (this.drawing) {\n      var rect = this.canvas.getBoundingClientRect();\n      var x = e.clientX - rect.left;\n      var y = e.clientY - rect.top;\n      this.cxt.lineTo(x, y);\n      this.cxt.stroke();\n      this.handwritingX.push(x);\n      this.handwritingY.push(y);\n    }\n  };\n\n  mouseUp = function () {\n    var w = [];\n    w.push(this.handwritingX);\n    w.push(this.handwritingY);\n    w.push([]);\n    this.trace.push(w);\n    this.drawing = false;\n    if (this.allowUndo) this.step.push(this.canvas.toDataURL());\n  };\n\n  touchStart = function (e) {\n    e.preventDefault();\n    this.cxt.lineWidth = this.lineWidth;\n    this.cxt.strokeStyle = this.lineColor;\n    this.handwritingX = [];\n    this.handwritingY = [];\n    var de = document.documentElement;\n    var box = this.canvas.getBoundingClientRect();\n    var top = box.top + window.pageYOffset - de.clientTop;\n    var left = box.left + window.pageXOffset - de.clientLeft;\n    var touch = e.changedTouches[0];\n    var touchX = touch.pageX - left;\n    var touchY = touch.pageY - top;\n    this.handwritingX.push(touchX);\n    this.handwritingY.push(touchY);\n    this.cxt.beginPath();\n    this.cxt.moveTo(touchX, touchY);\n  };\n\n  touchMove = function (e) {\n    e.preventDefault();\n    var touch = e.targetTouches[0];\n    var de = document.documentElement;\n    var box = this.canvas.getBoundingClientRect();\n    var top = box.top + window.pageYOffset - de.clientTop;\n    var left = box.left + window.pageXOffset - de.clientLeft;\n    var x = touch.pageX - left;\n    var y = touch.pageY - top;\n    this.handwritingX.push(x);\n    this.handwritingY.push(y);\n    this.cxt.lineTo(x, y);\n    this.cxt.stroke();\n  };\n\n  touchEnd = function (e) {\n    var w = [];\n    w.push(this.handwritingX);\n    w.push(this.handwritingY);\n    w.push([]);\n    this.trace.push(w);\n    if (this.allowUndo) this.step.push(this.canvas.toDataURL());\n  };\n\n  undo = function () {\n    if (!this.allowUndo || this.step.length <= 0) return;\n    else if (this.step.length === 1) {\n      if (this.allowRedo) {\n        this.redo_step.push(this.step.pop());\n        this.redo_trace.push(this.trace.pop());\n        this.cxt.clearRect(0, 0, this.width, this.height);\n      }\n    } else {\n      if (this.allowRedo) {\n        this.redo_step.push(this.step.pop());\n        this.redo_trace.push(this.trace.pop());\n      } else {\n        this.step.pop();\n        this.trace.pop();\n      }\n      this.loadFromUrl(this.step.slice(-1)[0], this);\n    }\n  };\n\n  redo = function () {\n    if (!this.allowRedo || this.redo_step.length <= 0) return;\n    this.step.push(this.redo_step.pop());\n    this.trace.push(this.redo_trace.pop());\n    this.loadFromUrl(this.step.slice(-1)[0], this);\n  };\n\n  erase = function () {\n    this.cxt.clearRect(0, 0, this.width, this.height);\n    this.step = [];\n    this.redo_step = [];\n    this.redo_trace = [];\n    this.trace = [];\n  };\n\n  recognize = function (trace, options, callback) {\n    // if (handwriting.Canvas && this instanceof handwriting.Canvas) {\n    //   trace = this.trace;\n    //   options = this.options;\n    //   callback = this.callback;\n    // } else if (!options) options = {};\n    trace = this.trace;\n    options = this.options;\n    callback = this.callback;\n\n    var data = JSON.stringify({\n      options: \"enable_pre_space\",\n      requests: [\n        {\n          writing_guide: {\n            writing_area_width: options.width || this.width || undefined,\n            writing_area_height: options.height || this.width || undefined,\n          },\n          ink: trace,\n          language: options.language || \"en\",\n        },\n      ],\n    });\n\n    var xhr = new XMLHttpRequest();\n    xhr.addEventListener(\"readystatechange\", function () {\n      if (this.readyState === 4) {\n        switch (this.status) {\n          case 200:\n            var response = JSON.parse(this.responseText);\n            var results;\n            if (response.length === 1)\n              callback(undefined, new Error(response[0]));\n            else results = response[1][0][1];\n            if (!!options.numOfWords) {\n              results = results.filter(function (result) {\n                return result.length === options.numOfWords;\n              });\n            }\n            if (!!options.numOfReturn) {\n              results = results.slice(0, options.numOfReturn);\n            }\n            callback(results, undefined);\n            break;\n          case 403:\n            callback(undefined, new Error(\"access denied\"));\n            break;\n          case 503:\n            callback(\n              undefined,\n              new Error(\"can't connect to recognition server\")\n            );\n            break;\n          default:\n            callback(undefined, new Error(\"Unexpected result code\"));\n        }\n      }\n    });\n    // xhr.open(\n    //   \"POST\",\n    //   \"https://www.google.com.tw/inputtools/request?ime=handwriting&app=mobilesearch&cs=1&oe=UTF-8\"\n    // );\n\n    xhr.open(\n      \"POST\",\n      \"https://www.google.com.au/inputtools/request?ime=handwriting&app=mobilesearch&cs=1&oe=UTF-8\"\n    );\n    xhr.setRequestHeader(\"content-type\", \"application/json\");\n    xhr.send(data);\n  };\n}\n\nexport default handwriting;\n"]},"metadata":{},"sourceType":"module"}